


<!doctype html>
<html class="no-js" lang="en">
  <head>
    
      <meta charset="utf-8">
      <meta content="width=device-width,initial-scale=1" name="viewport">
      
        <meta content="A C/C++ (Arduino) library for the PID law. Features a more complete realization and design of the PID law using tools from modern control theory, and signal processing. Available for use for your open-source project" name="description">
      
      
      
        <meta content="Oluwasegun Somefun" name="author">
      
      <link href="../assets/images/favicon.png" rel="shortcut icon">
      <meta content="mkdocs-1.1.2, mkdocs-material-5.2.2" name="generator">
    
    
      
        <title>Guide - ModernPIDControlSS Documentation</title>
      
    
    
      <link href="../assets/stylesheets/main.b8fb47b5.min.css" rel="stylesheet">
      
        <link href="../assets/stylesheets/palette.36d1b78f.min.css" rel="stylesheet">
      
      
        
        
        <meta content="#ff7043" name="theme-color">
      
    
    
    
      
        <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback" rel="stylesheet">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body data-md-color-accent="deep-purple" data-md-color-primary="deep-orange" data-md-color-scheme="default" dir="ltr">
  
    <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
    <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a class="md-skip" href="#simplified-algorithm-for-a-modern-implementation-of-the-pid-law">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav aria-label="Header" class="md-header-nav md-grid">
    <a aria-label="ModernPIDControlSS Documentation" class="md-header-nav__button md-logo" href=".." title="ModernPIDControlSS Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.42 5.29c-1.1-.1-2.07.71-2.17 1.82L10 10h2.82v2h-3l-.44 5.07A4.001 4.001 0 012 18.83l1.5-1.5c.33 1.05 1.46 1.64 2.5 1.3.78-.24 1.33-.93 1.4-1.74L7.82 12h-3v-2H8l.27-3.07a4.01 4.01 0 014.33-3.65c1.26.11 2.4.81 3.06 1.89l-1.5 1.5c-.25-.77-.93-1.31-1.74-1.38M22 13.65l-1.41-1.41-2.83 2.83-2.83-2.83-1.43 1.41 2.85 2.85-2.85 2.81 1.43 1.41 2.83-2.83 2.83 2.83L22 19.31l-2.83-2.81L22 13.65z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ModernPIDControlSS Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Guide
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a class="md-source" href="https://github.com/somefunagba/ModernPIDControlSS" title="Go to repository">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ModernPIDControlSS
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a class="md-tabs__link md-tabs__link--active" href="..">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a class="md-tabs__link" href="../about/about/">
          About
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a class="md-tabs__link" href="../releases/release/">
          Releases
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a aria-label="ModernPIDControlSS Documentation" class="md-nav__button md-logo" href=".." title="ModernPIDControlSS Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.42 5.29c-1.1-.1-2.07.71-2.17 1.82L10 10h2.82v2h-3l-.44 5.07A4.001 4.001 0 012 18.83l1.5-1.5c.33 1.05 1.46 1.64 2.5 1.3.78-.24 1.33-.93 1.4-1.74L7.82 12h-3v-2H8l.27-3.07a4.01 4.01 0 014.33-3.65c1.26.11 2.4.81 3.06 1.89l-1.5 1.5c-.25-.77-.93-1.31-1.74-1.38M22 13.65l-1.41-1.41-2.83 2.83-2.83-2.83-1.43 1.41 2.85 2.85-2.85 2.81 1.43 1.41 2.83-2.83 2.83 2.83L22 19.31l-2.83-2.81L22 13.65z"/></svg>

    </a>
    ModernPIDControlSS Documentation
  </label>
  
    <div class="md-nav__source">
      
<a class="md-source" href="https://github.com/somefunagba/ModernPIDControlSS" title="Go to repository">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ModernPIDControlSS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a class="md-nav__link" href=".." title="Home">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Guide
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a class="md-nav__link md-nav__link--active" href="./" title="Guide">
      Guide
    </a>
    
      
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#pid-law-representation">
    PID Law: Representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#usecase">
    Usecase
  </a>
  
    <nav aria-label="Usecase" class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-one-identify-the-maximum-value-of-the-output-to-be-controlled">
    STEP ONE: IDENTIFY THE MAXIMUM VALUE OF THE OUTPUT TO BE CONTROLLED
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-two-closed-loop-input-output-settling-time">
    STEP TWO: CLOSED-LOOP INPUT-OUTPUT SETTLING-TIME
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-3-implement-pid-control">
    STEP 3: IMPLEMENT PID CONTROL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#notice">
    Notice
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox">
    
    <label class="md-nav__link" for="nav-3">
      About
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav aria-label="About" class="md-nav" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a class="md-nav__link" href="../about/about/" title="About">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a class="md-nav__link" href="../about/license/" title="License">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox">
    
    <label class="md-nav__link" for="nav-4">
      Releases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav aria-label="Releases" class="md-nav" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a class="md-nav__link" href="../releases/release/" title="Release Log">
      Release Log
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#pid-law-representation">
    PID Law: Representation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#usecase">
    Usecase
  </a>
  
    <nav aria-label="Usecase" class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-one-identify-the-maximum-value-of-the-output-to-be-controlled">
    STEP ONE: IDENTIFY THE MAXIMUM VALUE OF THE OUTPUT TO BE CONTROLLED
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-two-closed-loop-input-output-settling-time">
    STEP TWO: CLOSED-LOOP INPUT-OUTPUT SETTLING-TIME
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a class="md-nav__link" href="#step-3-implement-pid-control">
    STEP 3: IMPLEMENT PID CONTROL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a class="md-nav__link" href="#notice">
    Notice
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="simplified-algorithm-for-a-modern-implementation-of-the-pid-law">Simplified Algorithm for a Modern Implementation of the PID Law<a class="headerlink" href="#simplified-algorithm-for-a-modern-implementation-of-the-pid-law" title="Permanent link">&para;</a></h1>
<p><!-- abstract, summary, tldr, info, todo, tip , hint, important, success, check, done, faq, help, question-->
<!-- warning, attention, failure, error, bug, missing, example, quote, cite--></p>
<div class="admonition abstract">
<p class="admonition-title">Introduction</p>
<p>Although, the concept and theory of the PID is considered established by many, yet still largely misunderstood. 
It is sometimes rated as a simple and old control algorithm. Quite truly, the overview representation is simple, but its design is not so.    </p>
<p>From the lens of neuroscience and psychology, the PID law is the simplest representation of active inference or perceptual control in nature. 
The PID law, actively tries to make inference to minimize the deviation of a perceived controllable behaviour from the expected behaviour. </p>
<p>In systems and control, this law is used as an algorithm for robust feedback control. It infers the necessary control input <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> to a dynamical system, to reach an achievable expected output <span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> of the dynamical system. 
This means that the PID law is an artificial intelligence (AI) for inference. It represents the complex intelligence of inference in nature. </p>
<p>Notably, Nicolai Minorsky, who proposed the seminal theoretical representation of the PID realised this in the early nineties. 
An important design question is: a general framework for this AI architecture and its parameters for guaranteed stable inference (control).      <br />
Two main problems in this AI exist. The representation, and the design of AI. Research in the control literature has mostly focused on the latter.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>Using modern control and signal processing theory, this library provides for practical use, a simple but robust realization of the PID law represented in critic form.
The features implemented are compactly listed in the <a href="../about/about/">about</a> page.
The problem of automatic design of the PID law for control is approached from the viewpoint of the 'closed PID-loop model'.
For a more technical understanding of this automatic tuning design, read the preprint at (<a href="https://arxiv.org/pdf/2006.00314">https://arxiv.org/pdf/2006.00314</a>). Also, please see the <a href="../about/license/">library license</a> for further details on library use.</p>
</div>
<h2 id="pid-law-representation">PID Law: Representation<a class="headerlink" href="#pid-law-representation" title="Permanent link">&para;</a></h2>
<p>The PID Law can be represented as a critic function: <span><span class="MathJax_Preview">u = f(r,y)</span><script type="math/tex">u = f(r,y)</script></span>
$$
u=f(r,y)=\lambda_p\,u_p + \lambda_i\,u_i + \lambda_d\,u_d
$$</p>
<!-- ## Tuning Usecase -->

<!--* `mkdocs new [dir-name]` - Create a new project.-->

<!--* `mkdocs serve` - Start the live-reloading docs server.-->

<!--* `mkdocs build` - Build the documentation site.-->

<!--* `mkdocs -h` - Print help message and exit.-->

<h2 id="usecase">Usecase<a class="headerlink" href="#usecase" title="Permanent link">&para;</a></h2>
<p>The tuning method included in this library as default is the CPLMFC. 
You can also use this library without using the tuner included (this usecase example will be added later).</p>
<p>The usecase example  provides a general overview for using the library for control. It is divided into three steps. 
The first two steps is to respectively obtain the maximum value of the output to be controlled and 
obtain the discrete-time step the output settles to an average value.
The last step uses information from the last two steps to run the automatic algorithm</p>
<p>See the step illustrations below.</p>
<p>The aim is to control the observed temperature using a system driven by a PWM input.</p>
<h3 id="step-one-identify-the-maximum-value-of-the-output-to-be-controlled">STEP ONE: IDENTIFY THE MAXIMUM VALUE OF THE OUTPUT TO BE CONTROLLED<a class="headerlink" href="#step-one-identify-the-maximum-value-of-the-output-to-be-controlled" title="Permanent link">&para;</a></h3>
<!-- ![cplmfc_TsID|150x150, 20%](img/idents_process_v2.png) -->

<p><img  alt="clmfc_TsID" src="https://raw.githubusercontent.com/somefunAgba/ModernPIDControlSS/master/docs/img/idents_process_v2.png" width="500" /></p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">C++</label><div class="tabbed-content"></div>
</div>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> *  STEP1: IDENTIFY THE MAXIMUM STEADY STATE OUTPUT OF THE SYSTEM</span>
<span class="cm"> *         GIVEN THE MAXIMUM CONTROL INPUT TO THE SYSTEM</span>
<span class="cm"> */</span>
<span class="cp">#include</span> <span class="cpf">&quot;Arduino.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Wire.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Adafruit_MCP4725.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Adafruit_MAX31865_library/Adafruit_MAX31865.h&quot;</span><span class="cp"></span>

<span class="cm">/* Global Declarations */</span>

<span class="cm">/* timings */</span>
<span class="kt">int</span> <span class="n">countseq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// take note of this time-step variable</span>
<span class="kt">double</span> <span class="n">t_current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">max_discrete_time_count</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span> <span class="c1">// vary as desired</span>
<span class="kt">int</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// equivalent to 1 seconds</span>

<span class="c1">// set max. control input</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">max_in</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// TODO: initialize other libraries for the DAC and ADC</span>
<span class="n">Adafruit_MCP4725</span> <span class="n">dac</span><span class="p">;</span> <span class="c1">// Adafruit MCP4725 dac</span>
<span class="n">Adafruit_MAX31865</span> <span class="n">thermo</span> <span class="o">=</span> <span class="n">Adafruit_MAX31865</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span> <span class="c1">// Adafruit MAX31865 PT100 adc</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Turn on Serial Comms.</span>
    <span class="c1">// 9600 baud is a compromise setting between easy to kill a runaway process</span>
    <span class="c1">// and very slow process</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span> <span class="c1">// Can Go Up to 2M</span>

    <span class="c1">//TODO: setup DAC and ADC</span>
    <span class="n">dac</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mh">0x62</span><span class="p">);</span> <span class="c1">// Adafruit MCP4725A1 library</span>
    <span class="n">thermo</span><span class="p">.</span><span class="n">readRTD</span><span class="p">();</span> <span class="c1">// Adafruit MAX31865 library</span>
<span class="p">}</span>

<span class="c1">// input and output variables</span>
<span class="kt">double</span> <span class="n">in_pwm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">out_celsius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ensure notion of fixed sampling</span>
    <span class="n">t_current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">countseq</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* MAX-OUTPUT SYS ID- START */</span>
        <span class="cm">/* log the output every dt milli-secs  */</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_current</span> <span class="o">&gt;=</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">in_pwm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4095</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="n">max_in</span><span class="p">;</span>
            <span class="n">dac</span><span class="p">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="n">in_pwm</span><span class="p">,</span><span class="s">&quot;false&quot;</span><span class="p">);</span> <span class="c1">// pass in max-input value to dac</span>
            <span class="n">out_celsius</span> <span class="o">=</span> <span class="n">thermo</span><span class="p">.</span><span class="n">temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mf">430.0</span><span class="p">);</span> <span class="c1">// get the output temperature</span>
            <span class="n">t_current</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// display input_pwm, output_celsius and current discrete-time step.</span>
        <span class="c1">// TODO: note down the maximum value</span>
        <span class="c1">//  where the out_celsius becomes averagely steady</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">in_pwm</span> <span class="o">+</span> <span class="s">&quot;, celsius: &quot;</span> <span class="o">+</span> <span class="n">out_celsius</span> <span class="o">+</span>
                    <span class="s">&quot;, countseq: &quot;</span> <span class="o">+</span> <span class="n">countseq</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;---</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">countseq</span> <span class="o">&gt;=</span> <span class="n">max_discrete_time_count</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">countseq</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">countseq</span><span class="o">++</span><span class="p">;</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="step-two-closed-loop-input-output-settling-time">STEP TWO: CLOSED-LOOP INPUT-OUTPUT SETTLING-TIME<a class="headerlink" href="#step-two-closed-loop-input-output-settling-time" title="Permanent link">&para;</a></h3>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">C++</label><div class="tabbed-content"></div>
</div>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> *  STEP2: IDENTIFY THE CLOSED-LOOP SETTLING-TIME OF THE OUTPUT</span>
<span class="cm"> *         GIVEN AN ERROR CONTROL INPUT TO THE SYSTEM</span>
<span class="cm"> */</span>
<span class="cp">#include</span> <span class="cpf">&quot;Arduino.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Wire.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Adafruit_MCP4725.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Adafruit_MAX31865_library/Adafruit_MAX31865.h&gt;</span><span class="cp"></span>

<span class="cm">/* Global Declarations */</span>

<span class="cm">/* timings */</span>
<span class="kt">int</span> <span class="n">countseq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// take note of this time-step variable</span>
<span class="kt">int</span> <span class="n">max_discrete_time_count</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span> <span class="c1">// vary as desired</span>

<span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">dt_control</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// control sampling-time; you can play with this as desired</span>
<span class="kt">double</span> <span class="n">t_prev_control</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt_control</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">dt_sys</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="c1">// equivalent to 1 seconds</span>
<span class="kt">double</span> <span class="n">t_prev_sys</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt_sys</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">t_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// set max. control input</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">in_max</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// 10V, equivalent to 4095 PWM</span>
<span class="c1">// set reference output celsius</span>
<span class="kt">double</span> <span class="n">ref_celsius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// input and output variables</span>
<span class="kt">int</span> <span class="n">in_pwm</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">in_val</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">out_celsius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">//TODO: fill with max output celsius value identified in step 1.</span>
<span class="kt">double</span> <span class="n">out_celsius_max</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// change this to the correct value</span>
<span class="c1">// TODO: initialize libraries for the DAC and ADC, if not Adafruit dac and adc</span>
<span class="n">Adafruit_MCP4725</span> <span class="n">dac</span><span class="p">;</span> <span class="c1">// Adafruit MCP4725 dac</span>
<span class="n">Adafruit_MAX31865</span> <span class="n">thermo</span> <span class="o">=</span> <span class="n">Adafruit_MAX31865</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span> <span class="c1">// Adafruit MAX31865 PT100 adc</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Turn on Serial Comms.</span>
    <span class="c1">// 9600 baud is a compromise setting between easy to kill a runaway process</span>
    <span class="c1">// and very slow process</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span> <span class="c1">// Can Go Up to 2M</span>

    <span class="c1">//TODO: setup DAC and ADC</span>
    <span class="n">dac</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mh">0x62</span><span class="p">);</span> <span class="c1">// Adafruit MCP4725A1 library</span>
    <span class="n">thermo</span><span class="p">.</span><span class="n">readRTD</span><span class="p">();</span> <span class="c1">// Adafruit MAX31865 library</span>

<span class="p">}</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ensure notion of fixed sampling</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">countseq</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">;</span>
        <span class="cm">/* CLOSED-LOOP N_TS SYS ID- START */</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">t_prev_control</span> <span class="o">+</span> <span class="n">dt_control</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">dt_control</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">countseq</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">double</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// can vary between 0.5 and 1</span>
                <span class="n">ref_celsius</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">out_celsius_max</span><span class="p">;</span>
                <span class="n">out_celsius</span> <span class="o">=</span> <span class="n">out_celsius_max</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">in_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_max</span><span class="o">/</span><span class="n">out_celsius_max</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ref_celsius</span><span class="o">-</span><span class="n">out_celsius</span><span class="p">);</span>
            <span class="n">in_pwm</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="mi">4095</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="n">in_val</span><span class="p">);</span> <span class="c1">// convert input voltage to pwm</span>
            <span class="n">t_prev_control</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">dac</span><span class="p">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="n">in_pwm</span><span class="p">,</span><span class="s">&quot;false&quot;</span><span class="p">);</span> <span class="c1">// pass in max-input value to dac</span>

        <span class="cm">/* SYSTEM OUTPUT SAMPLING-: EVERY DT_SYS SECONDS*/</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">t_prev_sys</span> <span class="o">+</span> <span class="n">dt_sys</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">out_celsius</span> <span class="o">=</span> <span class="n">thermo</span><span class="p">.</span><span class="n">temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mf">430.0</span><span class="p">);</span> <span class="c1">// get the output temperature</span>
            <span class="n">t_prev_sys</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// display input_pwm, output_celsius and current discrete-time step.</span>
        <span class="c1">//TODO: note down the countseq value,</span>
        <span class="c1">//  where the out_celsius becomes averagely steady.</span>
        <span class="c1">//  This value becomes the N_ts value for the PID control tuning algorithm</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">in_pwm</span> <span class="o">+</span> <span class="s">&quot;, celsius: &quot;</span> <span class="o">+</span> <span class="n">out_celsius</span> <span class="o">+</span>
                <span class="s">&quot;, countseq: &quot;</span> <span class="o">+</span> <span class="n">countseq</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;---</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">countseq</span> <span class="o">&gt;=</span> <span class="n">max_discrete_time_count</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">countseq</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">countseq</span><span class="o">++</span><span class="p">;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">;</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="step-3-implement-pid-control">STEP 3: IMPLEMENT PID CONTROL<a class="headerlink" href="#step-3-implement-pid-control" title="Permanent link">&para;</a></h3>
<p><img  alt="clmfc_overview" src="https://raw.githubusercontent.com/somefunAgba/ModernPIDControlSS/master/docs/img/cplmfc_overview.png" width="500" /></p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">C++</label><div class="tabbed-content"></div>
</div>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> *  STEP3: CLOSED-LOOP CONTROL OF THE OUTPUT-TEMPERATURE</span>
<span class="cm"> *         USING A PID-CONTROL PWM INPUT TO THE SYSTEM</span>
<span class="cm"> */</span>
<span class="cp">#include</span> <span class="cpf">&quot;Arduino.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;Wire.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Adafruit_MCP4725.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Adafruit_MAX31865_library/Adafruit_MAX31865.h&quot;</span><span class="cp"></span>

<span class="cm">/*PID Library*/</span>
<span class="cp">#include</span> <span class="cpf">&quot;ModernPIDControlSS.h&quot;</span><span class="cp"></span>

<span class="cm">/* Global Declarations */</span>

<span class="cm">/* timings */</span>
<span class="kt">int</span> <span class="n">countseq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// take note of this time-step variable</span>
<span class="kt">int</span> <span class="n">max_discrete_time_count</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span> <span class="c1">// vary as desired</span>

<span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">dt_control</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// control sampling-time; you can play with this as desired</span>
<span class="kt">double</span> <span class="n">dt_sys</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="c1">// equivalent to 1 seconds</span>
<span class="kt">double</span> <span class="n">t_prev_sys</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt_sys</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">t_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


<span class="c1">// set reference output celsius</span>
<span class="kt">double</span> <span class="n">ref_celsius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// input and output variables</span>
<span class="kt">int</span> <span class="n">in_pwm</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">in_val</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">out_celsius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// TODO: initialize other libraries for the DAC and ADC</span>
<span class="n">Adafruit_MCP4725</span> <span class="n">dac</span><span class="p">;</span> <span class="c1">// Adafruit MCP4725 dac</span>
<span class="n">Adafruit_MAX31865</span> <span class="n">thermo</span> <span class="o">=</span> <span class="n">Adafruit_MAX31865</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span> <span class="c1">// Adafruit MAX31865 PT100 adc</span>


<span class="cm">/* Parameters PID Structure Config. */</span>
<span class="c1">// 10 -&gt; max control input, 0 -&gt; min control input in voltage</span>
<span class="n">PIDNet</span>  <span class="nf">PID_I</span><span class="p">(</span><span class="n">ref_celsius</span><span class="p">,</span> <span class="n">out_celsius</span><span class="p">,</span> <span class="n">dt_control</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">cplmfc</span> <span class="n">cplmfc_tuner</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Turn on Serial Comms.</span>
    <span class="c1">// 9600 baud is a compromise setting between easy to kill a runaway process</span>
    <span class="c1">// and very slow process</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span> <span class="c1">// Can Go Up to 2M</span>

    <span class="c1">//TODO: setup DAC and ADC</span>
    <span class="n">dac</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mh">0x62</span><span class="p">);</span> <span class="c1">// Adafruit MCP4725A1 library</span>
    <span class="n">thermo</span><span class="p">.</span><span class="n">readRTD</span><span class="p">();</span> <span class="c1">// Adafruit MAX31865 library</span>

    <span class="cm">/* Parameters PID Structure Config. */</span>
     <span class="n">PID_I</span><span class="p">.</span><span class="n">set_bc_follow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

    <span class="cm">/* CPLMFC Tuning HyperParameter Config. */</span>
    <span class="cm">/* Hyper-Parameter for Kp and Critic Weights */</span> <span class="c1">// for P, I, D</span>
    <span class="c1">//TODO: increase alpha steadily to increase fast response;</span>
    <span class="c1">//cplmfc_tuner.set_alpha_critics( PID_I, alpha, lambda_i, lambda_p)</span>
    <span class="n">cplmfc_tuner</span><span class="p">.</span><span class="n">set_alpha_critics</span><span class="p">(</span> <span class="n">PID_I</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>

    <span class="cm">/* PID Commonsense Model Config. */</span>
    <span class="c1">// note: if the sampling-time is changed</span>
    <span class="c1">// rerun the closed-loop settling-time identification</span>
    <span class="c1">// to get the correct N_ts and N_tau_l</span>
    <span class="c1">// TODO: replace with identified settling-time count from step 2</span>
    <span class="kt">int</span> <span class="n">N_ts</span> <span class="o">=</span> <span class="mi">228</span><span class="p">;</span> <span class="c1">// N_ts at 0.1secs;</span>
    <span class="c1">// TODO: replace with identified delay-time count</span>
    <span class="c1">//  (that is: maximum time-step at which output = 0)</span>
    <span class="kt">int</span> <span class="n">N_tau_l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//cplmfc_tuner.begin( PID_I, N_ts, N_tau_l);</span>
    <span class="n">cplmfc_tuner</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span> <span class="n">PID_I</span><span class="p">,</span> <span class="n">N_ts</span><span class="p">,</span> <span class="n">N_tau_l</span><span class="p">);</span>

<span class="p">}</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ensure notion of fixed sampling</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">countseq</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">;</span>
        <span class="cm">/* CLOSED-LOOP START */</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="p">(</span> <span class="n">PID_I</span><span class="p">.</span><span class="n">T_prev</span> <span class="o">+</span>  <span class="n">PID_I</span><span class="p">.</span><span class="n">Ts</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">PID_I</span><span class="p">.</span><span class="n">Ts</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Run the PID and its tuning algorithm     </span>
            <span class="n">PID_kernelOS</span><span class="p">(</span> <span class="n">PID_I</span><span class="p">,</span> <span class="n">cplmfc_tuner</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">in_val</span> <span class="o">=</span>  <span class="n">PID_I</span><span class="p">.</span><span class="n">u</span><span class="p">;</span>
            <span class="n">in_pwm</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="mi">4095</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)</span><span class="o">*</span><span class="n">in_val</span><span class="p">);</span> <span class="c1">// convert input voltage to pwm</span>
        <span class="p">}</span>

        <span class="n">dac</span><span class="p">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="n">in_pwm</span><span class="p">,</span><span class="s">&quot;false&quot;</span><span class="p">);</span> <span class="c1">// pass in max-input value to dac</span>

        <span class="cm">/* SYSTEM OUTPUT SAMPLING-: EVERY DT_SYS SECONDS*/</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">t_prev_sys</span> <span class="o">+</span> <span class="n">dt_sys</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">out_celsius</span> <span class="o">=</span> <span class="n">thermo</span><span class="p">.</span><span class="n">temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mf">430.0</span><span class="p">);</span> <span class="c1">// get the output temperature</span>
             <span class="n">PID_I</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">out_celsius</span><span class="p">;</span>
            <span class="n">t_prev_sys</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="c1">// display input_pwm, output_celsius and current discrete-time step.</span>
        <span class="c1">// observe the values</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">in_pwm</span> <span class="o">+</span> <span class="s">&quot;, celsius: &quot;</span> <span class="o">+</span> <span class="n">out_celsius</span> <span class="o">+</span>
                <span class="s">&quot;, countseq: &quot;</span> <span class="o">+</span> <span class="n">countseq</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;---</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>

        <span class="n">countseq</span><span class="o">++</span><span class="p">;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">;</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<p>The identified settling-time is set with this line
<div class="highlight"><pre><span></span><code>    ...
    //cplmfc_tuner.begin( PID_I, N_ts, N_tau_l);
    cplmfc_tuner.begin( PID_I, N_ts, N_tau_l);
    ...
</code></pre></div>
<span><span class="MathJax_Preview">N_{ts}</span><script type="math/tex">N_{ts}</script></span> is the discrete settling-time count. 
<span><span class="MathJax_Preview">N_{tau_{l}}</span><script type="math/tex">N_{tau_{l}}</script></span> = 0 by default, is the discrete delay-time count when there is no change in output with respect to the input</p>
<p>Tuning performance is varied with this line in the set-up.
<div class="highlight"><pre><span></span><code>    ...
    //cplmfc_tuner.set_alpha_critics( PID_I, alpha, lambda_i, lambda_d)
    cplmfc_tuner.set_alpha_critics( PID_I,10.0,0.5,0.1);
    ...
</code></pre></div></p>
<p>It manually configures the main tuner hyper-parameter: <span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span>, 
and the critic weights: <span><span class="MathJax_Preview">\lambda_i</span><script type="math/tex">\lambda_i</script></span> = 0.5 by default and <span><span class="MathJax_Preview">\lambda_d</span><script type="math/tex">\lambda_d</script></span> = 0.1 by default</p>
<p>The <span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> constant is meant to gradually increased or reduced till you get a satisfactory response speed</p>
<p>If needed, vary the critic weight <span><span class="MathJax_Preview">\lambda_i</span><script type="math/tex">\lambda_i</script></span> to reduce overshoot or reduce steady-state error =&gt; min:0, max: 1.0</p>
<p>If needed, reduce the critic weight <span><span class="MathJax_Preview">\lambda_d</span><script type="math/tex">\lambda_d</script></span> to reduce oscillatory response, if any =&gt; min: 0, max: 1.0</p>
<h2 id="notice">Notice<a class="headerlink" href="#notice" title="Permanent link">&para;</a></h2>
<p>Please, this guide is still in a beta state. It will be updated gradually.</p>
<div class="admonition faq">
<p class="admonition-title">Faq</p>
<p>Please, feel free to contact me at <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#111;&#97;&#115;&#111;&#109;&#101;&#102;&#117;&#110;&#64;&#102;&#117;&#116;&#97;&#46;&#101;&#100;&#117;&#46;&#110;&#103;">&#111;&#97;&#115;&#111;&#109;&#101;&#102;&#117;&#110;&#64;&#102;&#117;&#116;&#97;&#46;&#101;&#100;&#117;&#46;&#110;&#103;</a> for any questions or to report any bug.</p>
</div>
<!--    mkdocs.yml    # The configuration file.-->

<!--    docs/-->

<!--        index.md  # The documentation homepage.-->

<!--        ...       # Other markdown pages, images and other files.-->
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: August 10, 2020
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav aria-label="Footer" class="md-footer-nav__inner md-grid">
        
          <a class="md-footer-nav__link md-footer-nav__link--prev" href=".." rel="prev" title="Home">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a class="md-footer-nav__link md-footer-nav__link--next" href="../about/about/" rel="next" title="About">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                About
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020. Oluwasegun Somefun
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a class="md-footer-social__link" href="https://github.com/somefunagba" rel="noopener" target="_blank" title="github.com">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a class="md-footer-social__link" href="https://twitter.com/somefunagba" rel="noopener" target="_blank" title="twitter.com">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a class="md-footer-social__link" href="https://linkedin.com/in/oluwasegunsomefun/" rel="noopener" target="_blank" title="linkedin.com">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.de50e36d.min.js"></script>
      <script src="../assets/javascripts/bundle.ff925e8b.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>